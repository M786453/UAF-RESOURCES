package com.example.httphistory;

import android.os.AsyncTask;
import android.util.Log;

import java.io.BufferedInputStream;
import java.io.DataInputStream;
import java.io.EOFException;
import java.net.ServerSocket;
import java.net.Socket;

public class ServerListen extends AsyncTask<Void, Void, String> {


    private String server_listen(){

        String strHttpHistory = "";

        try {

            int PROXY_PORT = 5000;

            ServerSocket server_socket = new ServerSocket(PROXY_PORT);

            strHttpHistory += "Server Started...\n";

            strHttpHistory += "Waiting for Client...\n";

            Socket socket = server_socket.accept();

            strHttpHistory += "Client Accepted...\n\n";

            DataInputStream in = new DataInputStream(new BufferedInputStream(socket.getInputStream()));

            String line = "";

            while(line != null){

                    strHttpHistory += line;

                    line = in.readLine();


            }

            strHttpHistory += "\n\nClosing Connection...";

            server_socket.close();

            in.close();

        }catch(Exception e){

            Log.e("server_error", e.getMessage());

        }

        return strHttpHistory;
    }

    @Override
    protected String doInBackground(Void... voids) {

        return server_listen();
    }
}
